// ==UserScript==
// @name         Example Userscript
// @version      0.1.0
// @match        *://example.com/*
// @match        *://www.example.com/*
// @run-at       document-start
// @downloadURL  https://simonalling.github.io/userscripts/example-userscript.user.js
// @updateURL    https://simonalling.github.io/userscripts/example-userscript.meta.js
// ==/UserScript==
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([,function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),i=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(i).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(r[i]=!0)}for(o=0;o<e.length;o++){var a=e[o];"number"==typeof a[0]&&r[a[0]]||(n&&!a[2]?a[2]=n:n&&(a[2]="("+a[2]+") and ("+n+")"),t.push(a))}},t}},function(e,t,n){var r=n(3);e.exports="string"==typeof r?r:r.toString()},function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n/*\n******** README ********\n\nThis is the main stylesheet for the userscript.\n\nLogic such as conditions for certain CSS snippets should reside in `stylesheet-modules.ts`.\n*/\nhtml body {\n  background-color: lightgreen;\n  color: green; }\n\nbody h1::before, body h1::after {\n  content: " \\2605   "; }\n',""])},function(e,t,n){var r=n(5);e.exports="string"==typeof r?r:r.toString()},function(e,t,n){(t=e.exports=n(1)(!1)).push([e.i,".example-userscript-foobar {\n  font-family: monospace; }\n",""]),t.locals={"example-userscript-foobar":"example-userscript-foobar",exampleUserscriptFoobar:"example-userscript-foobar"}},function(e,t,n){"use strict";n.r(t);const r=[o,i,a,function(e){return"symbol"==typeof e},s,function(e){return void 0===e}];function o(e){return"boolean"==typeof e}function i(e){return"number"==typeof e}function a(e){return"string"==typeof e}function s(e){return null===e}function u(e){return r.some(t=>t(e))}function c(e,t,n){return function(e,t){return Object.defineProperty(t,"name",{value:e,writable:!1})}(`${e.name}(${t.name})`,n)}function l(e){if(u(e))throw new TypeError(`${e.name} cannot be used as a type in the is() function.`);return c(l,e,t=>t instanceof e)}function f(e){for(const t of r)if(t(e))return e=>t(e);if(l(Array)(e))return t=>!(e.length>0)||t.every(f(e[0]));if(e.constructor instanceof Function)return l(e.constructor);throw new TypeError(f.name+" cannot use this object as reference because it has no constructor: "+JSON.stringify(e))}function p(e){return document.getElementById(e)}const d=l(HTMLElement);const h="\n\n";function m(e){return e.map(e=>e.css).join(h)}function g(e,t){!function(e,t){const n=document.createElement("style");if(n.textContent=e,a(t)){if(d(p(t)))throw new Error(`Cannot insert CSS with ID ${JSON.stringify(t)} because there is already an element with that ID.`);n.id=t}document.head.appendChild(n)}(m(e.filter(e=>e.condition)),t)}var v="Example.com";function b(e){return t=>e+t}const y="example-userscript",_="Example Userscript",w="0.1.0",N=y+"-",x=y+"-",S=500,E=b(N),$=b(x),C=E("main-style-element"),O=$("foobar"),R=$("preference-description");const k=function(e="[Logger]"){return{log(t){console.log(e,t)},logInfo(t){console.info(e,t)},logWarning(t){console.warn(e,t)},logError(t){console.error(e,t)}}}(`[${_}]`),T=k.log,L=(k.logInfo,k.logWarning),I=k.logError;var P;!function(e){e[e.OK=0]="OK",e[e.ABSENT=1]="ABSENT",e[e.TYPE_ERROR=2]="TYPE_ERROR",e[e.JSON_ERROR=3]="JSON_ERROR",e[e.LOCALSTORAGE_ERROR=4]="LOCALSTORAGE_ERROR"}(P||(P={}));const M={Infinity:1/0,"-Infinity":-1/0,NaN:NaN};function U(e,t){try{const n=function(e,t){const n=localStorage.getItem(e);if(s(n))return null;const r=M[n];if(f(t)(r))return r;const o=JSON.parse(n);if(f(t)(o))return o;throw new TypeError("Saved value had wrong type.")}(e,t);return s(n)?{status:1,value:t}:{status:0,value:n}}catch(e){return{status:l(SyntaxError)(e)?3:l(TypeError)(e)?2:4,value:t}}}function A(e,t){try{return function(e,t){const n=function(e){for(const t in M){const n=M[t];if(e===n||Number.isNaN(e)&&Number.isNaN(n))return t}return JSON.stringify(e)}(t);localStorage.setItem(e,n)}(e,t),{status:0,value:t}}catch(e){return{status:l(SyntaxError)(e)||l(TypeError)(e)?3:4,value:t}}}const j={Infinity:1/0,"-Infinity":-1/0,NaN:NaN};function D(e,t){return void 0===t?e:t}function V(e,t){for(const e in j){const n=j[e];if(t===n||Number.isNaN(t)&&Number.isNaN(n))return e}return t}function B(e){return JSON.stringify(e,V)}function J(e,t){t.constraints=e.concat(D([],t.constraints))}class q{constructor(e){if(""===e.key)throw new TypeError(`A preference key cannot be the empty string, but this was the case for this ${this.getType()} data:\n${B(e)}`);this.key=e.key,this.default=e.default,this.label=e.label,this.description=D("",e.description),this.constraints=D([],e.constraints),this.dependencies=D([],e.dependencies),this.extras=D({},e.extras);const t=this.validate(e.default);a(t)&&this.invalidValue(e.default,t)}validate(e){const t=this.constraints;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!r.requirement(e))return r.message(e)}return{value:e}}toValid(e){return a(this.validate(e))?this.default:e}getType(){return this.constructor.name}asString(){return`${this.constructor.name} '${this.key}'`}invalidValue(e,t){throw new Error(`${B(e)} is not a valid value for ${this.asString()}. Reason: ${t}`)}}var F;function G(e){return`Unknown preference. Please use only preferences from the object used to initialize the ${W.name}. This one is not among them:\n\n${B(e)}.`}!function(e){e[e.OK=0]="OK",e[e.INVALID_VALUE=1]="INVALID_VALUE",e[e.TYPE_ERROR=2]="TYPE_ERROR",e[e.JSON_ERROR=3]="JSON_ERROR",e[e.LOCALSTORAGE_ERROR=4]="LOCALSTORAGE_ERROR"}(F||(F={}));class W{constructor(e,t){this.LS_PREFIX=t,this.cache=new Map;const n=[],r=H(e);r.forEach(e=>{const t=e.key;if(n.indexOf(t)>-1)throw new Error(`Duplicate preference key ${B(t)}.`);this.cache.set(e,e.default),n.push(t)}),r.forEach(e=>{e.dependencies.forEach(t=>{if(void 0===this.cache.get(t.preference))throw new Error(`Dependency error in preference ${B(e.key)}: ${G(t.preference)}`)})})}get(e){const t=this.cache.get(e);if(!f(e.default)(t))throw new Error(G(e));const n=U(this.LS_PREFIX+e.key,e.default);if(0===n.status){return a(e.validate(n.value))?{status:1,value:e.toValid(n.value),saved:n.value}:{status:0,value:n.value}}return{status:K(n.status),value:t}}set(e,t){if(!f(e.default)(this.cache.get(e)))throw new Error(G(e));if(a(e.validate(t)))return{status:1,value:t};this.cache.set(e,t);const n=A(this.LS_PREFIX+e.key,t);return{status:K(n.status),value:n.value}}}function H(e){return Object.keys(e).map(t=>e[t]).reduce((e,t)=>e.concat(l(q)(t)?t:H(t._)),[])}function K(e){switch(e){case 0:case 1:return 0;case 2:return 2;case 3:return 3;case 4:return 4}return function(e){throw new Error("assertUnreachable: "+e)}(e)}class X extends q{}class Y extends q{static postParse(e,t){return a(t)?t:e.validate(t.value)}constructor(e){const t=D(!1,e.infinite);J([t?{requirement:e=>!Number.isNaN(e),message:e=>`${e} is not a number.`}:{requirement:Number.isFinite,message:e=>`${e} is not a finite number.`}],e),super(e),this.infinite=t}}class z extends Y{constructor(e){J([z.CONSTRAINT_INTEGER],e),super(e)}static parse(e){const t=parseInt(e,10);return Number.isNaN(t)?`"${e}" is not an integer.`:{value:t}}toValid(e){return super.toValid(Math.round(e))}fromString(e){return Y.postParse(this,z.parse(e))}}z.isInteger=(e=>Number.isInteger(e)||Math.abs(e)===1/0),z.CONSTRAINT_INTEGER={requirement:z.isInteger,message:e=>`${e} is not an integer.`};class Q extends Y{constructor(e){const t=e.min,n=e.max;if(J([{requirement:e=>e>=t,message:e=>`${e} is smaller than minimum value ${t}.`},{requirement:e=>e<=n,message:e=>`${e} is greater than maximum value ${n}.`}],e),super(e),Number.isNaN(t)||Number.isNaN(n))throw new Error(`Parameters 'min' and 'max' cannot be NaN, but they were ${t} and ${n}, respectively, for ${this.asString()}.`);if(!(this.infinite||Number.isFinite(t)&&Number.isFinite(n)))throw new Error(`Parameters 'min' and 'max' must be finite numbers (unless 'infinite' is true), but they were ${t} and ${n}, respectively, for ${this.asString()}.`);if(t>n)throw new Error(`Parameter 'min' cannot be greater than parameter 'max', but they were ${t} and ${n}, respectively, for ${this.asString()}.`);this.min=t,this.max=n}toValid(e){return super.toValid(Math.max(this.min,Math.min(this.max,e)))}}class Z extends Q{constructor(e){if(J([z.CONSTRAINT_INTEGER],e),super(e),!z.isInteger(e.min)||!z.isInteger(e.max))throw new TypeError(`Parameters 'min' and 'max' must be integers, but they were ${e.min} and ${e.max} for ${this.asString()}.`)}toValid(e){return super.toValid(Math.round(e))}fromString(e){return Y.postParse(this,z.parse(e))}}class ee extends q{constructor(e){const t=D(0,e.minLength),n=D(1/0,e.maxLength),r=[];if(e.multiline||r.push({requirement:e=>!e.includes("\n"),message:e=>"Line breaks are not allowed."}),t>0&&r.push({requirement:e=>e.length>=t,message:e=>`Minimum length is ${t} characters.`}),n<1/0&&r.push({requirement:e=>e.length<=n,message:e=>`Maximum length ${n} exceeded.`}),J(r,e),super(e),t<0||n<0)throw new Error(`Parameters 'minLength' and 'maxLength' cannot be negative, but they were ${t} and ${n}, respectively, for ${this.asString()}.`);this.multiline=e.multiline,this.maxLength=n,this.minLength=t}toValid(e){const t=e.substring(0,this.maxLength);return super.toValid(this.multiline?t:t.replace(ee.REGEX_LINE_BREAKS," "))}fromString(e){return this.validate(e)}}ee.REGEX_LINE_BREAKS=/\n+/g;var te={foobars:{label:"Foobars",_:{insert:new X({key:"insert_foobars",label:"Insert foobars",description:"Insert some foobars",default:!0}),number:new Z({key:"number_of_foobars",label:"Number of foobars",description:"Number of foobars to insert",min:0,max:100,default:5})}},username:new ee({key:"username",label:"Username",description:"Your username",default:"John Smith",multiline:!1,maxLength:50,constraints:[{requirement:e=>!/^\s/.test(e),message:e=>"Leading whitespace not allowed."},{requirement:e=>!/\s$/.test(e),message:e=>"Trailing whitespace not allowed."}]})};const ne=function(e,t,n){const r=new W(e,t+"-preference-"),o={get:i,set:a,reset:s,resetAll:function(){H(e).forEach(s)},enabled:function(e){return e.dependencies.every(e=>e.condition(i(e.preference)))},htmlMenu:function(t){return t(e)}};function i(e){return n({action:"get",preference:e,response:r.get(e)},o).value}function a(e,t){n({action:"set",preference:e,response:r.set(e,t)},o)}function s(e){a(e,e.default)}return o}(te,y,function(e,t){const n=e.response;switch(n.status){case 0:return n;case 1:return"get"===e.action&&(L(`The value found in localStorage for preference '${e.preference.key}' (${JSON.stringify(n.saved)}) was invalid. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),"set"===e.action&&L(`Could not set value ${JSON.stringify(n.value)} for preference '${e.preference.key}' because it was invalid.`),n;case 2:return"get"===e.action&&(L(`The value found in localStorage for preference '${e.preference.key}' was not a ${typeof e.preference.default}. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),n;case 3:return"get"===e.action&&(L(`The value found in localStorage for preference '${e.preference.key}' could not be parsed. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),n;case 4:switch(e.action){case"get":return I(`Could not read preference '${e.preference.key}' because localStorage could not be accessed. Using value ${JSON.stringify(e.preference.default)}.`),n;case"set":return I(`Could not save value ${JSON.stringify(e.response.value)} for preference '${e.preference.key}' because localStorage could not be accessed.`),n}return re(e.action)}return re(n.status)});function re(e){throw new Error("assertUnreachable: "+e)}var oe=[{condition:!0,css:n(2)},{condition:ne.get(te.foobars._.insert),css:n(4)}];const ie=v,ae="    ";function se(e){return t=>e===t}function ue(e,t){return n=>e(t(n))}const ce=!0,le=!1;class fe{constructor(e){this.condition=e.condition,this.description=e.description}}class pe extends fe{constructor(e){super(e),this.action=e.action}}class de extends fe{constructor(e){super(e),this.selectors=e.selectors,this.action=e.action}}function he(e){const t=document.createElement("div");return t.classList.add(O),t.textContent=`div.${O} number ${e}`,t}const me=function(e,t,n,r){let i=!0;function a(e){l(de)(e)&&n(e)}function s(e){const t=(()=>{if(l(pe)(e))return e.action();if(l(de)(e)){const t=e.selectors,n=Object.keys(t).map(e=>({key:e,element:document.querySelector(t[e])}));if(n.map(e=>e.element).some(se(null)))return le;const r=n.reduce((e,t)=>Object.defineProperty(e,t.key,{value:t.element}),{});return e.action(r)}throw new TypeError("Unknown operation type.")})();return o(t)?t:ce}return{start:function(){!function e(n){if(i){const r=n.filter(ue(se(le),s));r.length>0&&setTimeout(()=>{e(r)},t)}else n.length>0?n.forEach(a):r()}(e)},stop:function(){i=!1}}}([new de({description:"change heading content",condition:!0,selectors:{heading:"body h1"},action:e=>{e.heading.textContent=_+" working!"}}),new de({description:"insert foobars",condition:ne.get(te.foobars._.insert),selectors:{mainDiv:"body div"},action:e=>{const t=ne.get(te.foobars._.number),n=document.createElement("h2"),r=document.createTextNode(`Below are ${t} foobars. `),o=document.createElement("a");o.textContent="Moar!",o.href="javascript:void(0)",o.addEventListener("click",()=>{ne.set(te.foobars._.number,t+1),location.reload()}),n.appendChild(r),n.appendChild(o),e.mainDiv.appendChild(n);for(let e=1;e<=t;e++)document.body.appendChild(he(e))}}),new pe({description:"change title",condition:!0,action:()=>{document.title=document.title+` [${_} ${w}]`}})].filter(e=>e.condition),200,ue(I,function(e){const t=Object.keys(e.selectors).length>1;return`Could not ${e.description}.\n\n${t?"One or more of these selectors":"This selector"} didn't match anything:\n\n${function(e){return e.map(e=>ae+e).join("\n")}(Object.values(e.selectors))}\n\nThis problem might be caused by ${ie} changing its content/structure, in which case ${_} needs to be updated. Otherwise it's probably a bug in ${_}.\n\nIf you file a bug report, please include this message.`}),()=>T("Operations done!"));var ge=function(){},ve={},be=[],ye=[];function _e(e,t){var n,r,o,i,a=ye;for(i=arguments.length;i-- >2;)be.push(arguments[i]);for(t&&null!=t.children&&(be.length||be.push(t.children),delete t.children);be.length;)if((r=be.pop())&&void 0!==r.pop)for(i=r.length;i--;)be.push(r[i]);else"boolean"==typeof r&&(r=null),(o="function"!=typeof e)&&(null==r?r="":"number"==typeof r?r=String(r):"string"!=typeof r&&(o=!1)),o&&n?a[a.length-1]+=r:a===ye?a=[r]:a.push(r),n=o;var s=new ge;return s.nodeName=e,s.children=a,s.attributes=null==t?void 0:t,s.key=null==t?void 0:t.key,void 0!==ve.vnode&&ve.vnode(s),s}function we(e,t){for(var n in t)e[n]=t[n];return e}var Ne="function"==typeof Promise?Promise.resolve().then.bind(Promise.resolve()):setTimeout;var xe=/acit|ex(?:s|g|n|p|$)|rph|ows|mnc|ntw|ine[ch]|zoo|^ord/i,Se=[];function Ee(e){!e._dirty&&(e._dirty=!0)&&1==Se.push(e)&&(ve.debounceRendering||Ne)($e)}function $e(){var e,t=Se;for(Se=[];e=t.pop();)e._dirty&&We(e)}function Ce(e,t,n){return"string"==typeof t||"number"==typeof t?void 0!==e.splitText:"string"==typeof t.nodeName?!e._componentConstructor&&Oe(e,t.nodeName):n||e._componentConstructor===t.nodeName}function Oe(e,t){return e.normalizedNodeName===t||e.nodeName.toLowerCase()===t.toLowerCase()}function Re(e){var t=we({},e.attributes);t.children=e.children;var n=e.nodeName.defaultProps;if(void 0!==n)for(var r in n)void 0===t[r]&&(t[r]=n[r]);return t}function ke(e){var t=e.parentNode;t&&t.removeChild(e)}function Te(e,t,n,r,o){if("className"===t&&(t="class"),"key"===t);else if("ref"===t)n&&n(null),r&&r(e);else if("class"!==t||o)if("style"===t){if(r&&"string"!=typeof r&&"string"!=typeof n||(e.style.cssText=r||""),r&&"object"==typeof r){if("string"!=typeof n)for(var i in n)i in r||(e.style[i]="");for(var i in r)e.style[i]="number"==typeof r[i]&&!1===xe.test(i)?r[i]+"px":r[i]}}else if("dangerouslySetInnerHTML"===t)r&&(e.innerHTML=r.__html||"");else if("o"==t[0]&&"n"==t[1]){var a=t!==(t=t.replace(/Capture$/,""));t=t.toLowerCase().substring(2),r?n||e.addEventListener(t,Le,a):e.removeEventListener(t,Le,a),(e._listeners||(e._listeners={}))[t]=r}else if("list"!==t&&"type"!==t&&!o&&t in e){try{e[t]=null==r?"":r}catch(e){}null!=r&&!1!==r||"spellcheck"==t||e.removeAttribute(t)}else{var s=o&&t!==(t=t.replace(/^xlink:?/,""));null==r||!1===r?s?e.removeAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase()):e.removeAttribute(t):"function"!=typeof r&&(s?e.setAttributeNS("http://www.w3.org/1999/xlink",t.toLowerCase(),r):e.setAttribute(t,r))}else e.className=r||""}function Le(e){return this._listeners[e.type](ve.event&&ve.event(e)||e)}var Ie=[],Pe=0,Me=!1,Ue=!1;function Ae(){for(var e;e=Ie.pop();)ve.afterMount&&ve.afterMount(e),e.componentDidMount&&e.componentDidMount()}function je(e,t,n,r,o,i){Pe++||(Me=null!=o&&void 0!==o.ownerSVGElement,Ue=null!=e&&!("__preactattr_"in e));var a=De(e,t,n,r,i);return o&&a.parentNode!==o&&o.appendChild(a),--Pe||(Ue=!1,i||Ae()),a}function De(e,t,n,r,o){var i=e,a=Me;if(null!=t&&"boolean"!=typeof t||(t=""),"string"==typeof t||"number"==typeof t)return e&&void 0!==e.splitText&&e.parentNode&&(!e._component||o)?e.nodeValue!=t&&(e.nodeValue=t):(i=document.createTextNode(t),e&&(e.parentNode&&e.parentNode.replaceChild(i,e),Ve(e,!0))),i.__preactattr_=!0,i;var s=t.nodeName;if("function"==typeof s)return function(e,t,n,r){var o=e&&e._component,i=o,a=e,s=o&&e._componentConstructor===t.nodeName,u=s,c=Re(t);for(;o&&!u&&(o=o._parentComponent);)u=o.constructor===t.nodeName;o&&u&&(!r||o._component)?(Ge(o,c,3,n,r),e=o.base):(i&&!s&&(He(i),e=a=null),o=qe(t.nodeName,c,n),e&&!o.nextBase&&(o.nextBase=e,a=null),Ge(o,c,1,n,r),e=o.base,a&&e!==a&&(a._component=null,Ve(a,!1)));return e}(e,t,n,r);if(Me="svg"===s||"foreignObject"!==s&&Me,s=String(s),(!e||!Oe(e,s))&&(i=function(e,t){var n=t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);return n.normalizedNodeName=e,n}(s,Me),e)){for(;e.firstChild;)i.appendChild(e.firstChild);e.parentNode&&e.parentNode.replaceChild(i,e),Ve(e,!0)}var u=i.firstChild,c=i.__preactattr_,l=t.children;if(null==c){c=i.__preactattr_={};for(var f=i.attributes,p=f.length;p--;)c[f[p].name]=f[p].value}return!Ue&&l&&1===l.length&&"string"==typeof l[0]&&null!=u&&void 0!==u.splitText&&null==u.nextSibling?u.nodeValue!=l[0]&&(u.nodeValue=l[0]):(l&&l.length||null!=u)&&function(e,t,n,r,o){var i,a,s,u,c,l=e.childNodes,f=[],p={},d=0,h=0,m=l.length,g=0,v=t?t.length:0;if(0!==m)for(var b=0;b<m;b++){var y=l[b],_=y.__preactattr_,w=v&&_?y._component?y._component.__key:_.key:null;null!=w?(d++,p[w]=y):(_||(void 0!==y.splitText?!o||y.nodeValue.trim():o))&&(f[g++]=y)}if(0!==v)for(var b=0;b<v;b++){u=t[b],c=null;var w=u.key;if(null!=w)d&&void 0!==p[w]&&(c=p[w],p[w]=void 0,d--);else if(h<g)for(i=h;i<g;i++)if(void 0!==f[i]&&Ce(a=f[i],u,o)){c=a,f[i]=void 0,i===g-1&&g--,i===h&&h++;break}c=De(c,u,n,r),s=l[b],c&&c!==e&&c!==s&&(null==s?e.appendChild(c):c===s.nextSibling?ke(s):e.insertBefore(c,s))}if(d)for(var b in p)void 0!==p[b]&&Ve(p[b],!1);for(;h<=g;)void 0!==(c=f[g--])&&Ve(c,!1)}(i,l,n,r,Ue||null!=c.dangerouslySetInnerHTML),function(e,t,n){var r;for(r in n)t&&null!=t[r]||null==n[r]||Te(e,r,n[r],n[r]=void 0,Me);for(r in t)"children"===r||"innerHTML"===r||r in n&&t[r]===("value"===r||"checked"===r?e[r]:n[r])||Te(e,r,n[r],n[r]=t[r],Me)}(i,t.attributes,c),Me=a,i}function Ve(e,t){var n=e._component;n?He(n):(null!=e.__preactattr_&&e.__preactattr_.ref&&e.__preactattr_.ref(null),!1!==t&&null!=e.__preactattr_||ke(e),Be(e))}function Be(e){for(e=e.lastChild;e;){var t=e.previousSibling;Ve(e,!0),e=t}}var Je=[];function qe(e,t,n){var r,o=Je.length;for(e.prototype&&e.prototype.render?(r=new e(t,n),Ke.call(r,t,n)):((r=new Ke(t,n)).constructor=e,r.render=Fe);o--;)if(Je[o].constructor===e)return r.nextBase=Je[o].nextBase,Je.splice(o,1),r;return r}function Fe(e,t,n){return this.constructor(e,n)}function Ge(e,t,n,r,o){e._disable||(e._disable=!0,e.__ref=t.ref,e.__key=t.key,delete t.ref,delete t.key,void 0===e.constructor.getDerivedStateFromProps&&(!e.base||o?e.componentWillMount&&e.componentWillMount():e.componentWillReceiveProps&&e.componentWillReceiveProps(t,r)),r&&r!==e.context&&(e.prevContext||(e.prevContext=e.context),e.context=r),e.prevProps||(e.prevProps=e.props),e.props=t,e._disable=!1,0!==n&&(1!==n&&!1===ve.syncComponentUpdates&&e.base?Ee(e):We(e,1,o)),e.__ref&&e.__ref(e))}function We(e,t,n,r){if(!e._disable){var o,i,a,s=e.props,u=e.state,c=e.context,l=e.prevProps||s,f=e.prevState||u,p=e.prevContext||c,d=e.base,h=e.nextBase,m=d||h,g=e._component,v=!1,b=p;if(e.constructor.getDerivedStateFromProps&&(u=we(we({},u),e.constructor.getDerivedStateFromProps(s,u)),e.state=u),d&&(e.props=l,e.state=f,e.context=p,2!==t&&e.shouldComponentUpdate&&!1===e.shouldComponentUpdate(s,u,c)?v=!0:e.componentWillUpdate&&e.componentWillUpdate(s,u,c),e.props=s,e.state=u,e.context=c),e.prevProps=e.prevState=e.prevContext=e.nextBase=null,e._dirty=!1,!v){o=e.render(s,u,c),e.getChildContext&&(c=we(we({},c),e.getChildContext())),d&&e.getSnapshotBeforeUpdate&&(b=e.getSnapshotBeforeUpdate(l,f));var y,_,w=o&&o.nodeName;if("function"==typeof w){var N=Re(o);(i=g)&&i.constructor===w&&N.key==i.__key?Ge(i,N,1,c,!1):(y=i,e._component=i=qe(w,N,c),i.nextBase=i.nextBase||h,i._parentComponent=e,Ge(i,N,0,c,!1),We(i,1,n,!0)),_=i.base}else a=m,(y=g)&&(a=e._component=null),(m||1===t)&&(a&&(a._component=null),_=je(a,o,c,n||!d,m&&m.parentNode,!0));if(m&&_!==m&&i!==g){var x=m.parentNode;x&&_!==x&&(x.replaceChild(_,m),y||(m._component=null,Ve(m,!1)))}if(y&&He(y),e.base=_,_&&!r){for(var S=e,E=e;E=E._parentComponent;)(S=E).base=_;_._component=S,_._componentConstructor=S.constructor}}for(!d||n?Ie.unshift(e):v||(e.componentDidUpdate&&e.componentDidUpdate(l,f,b),ve.afterUpdate&&ve.afterUpdate(e));e._renderCallbacks.length;)e._renderCallbacks.pop().call(e);Pe||r||Ae()}}function He(e){ve.beforeUnmount&&ve.beforeUnmount(e);var t=e.base;e._disable=!0,e.componentWillUnmount&&e.componentWillUnmount(),e.base=null;var n=e._component;n?He(n):t&&(t.__preactattr_&&t.__preactattr_.ref&&t.__preactattr_.ref(null),e.nextBase=t,ke(t),Je.push(e),Be(t)),e.__ref&&e.__ref(null)}function Ke(e,t){this._dirty=!0,this.context=t,this.props=e,this.state=this.state||{},this._renderCallbacks=[]}function Xe(e,t,n){return je(n,e,{},!1,t,!1)}we(Ke.prototype,{setState:function(e,t){var n=this.prevState=this.state;"function"==typeof e&&(e=e(n,this.props)),this.state=we(we({},n),e),t&&this._renderCallbacks.push(t),Ee(this)},forceUpdate:function(e){e&&this._renderCallbacks.push(e),We(this,2)},render:function(){}});class Ye extends Y{static parse(e){const t=parseFloat(e);return Number.isNaN(t)?`"${e}" is not a number.`:{value:t}}fromString(e){return Y.postParse(this,Ye.parse(e))}}class ze extends Q{fromString(e){return Y.postParse(this,Ye.parse(e))}}class Qe extends q{constructor(e){const t=e.options;if(J([{requirement:e=>t.some(t=>t.value===e),message:e=>`${B(e)} is not among the available options.`}],e),super(e),t.length<2)throw new Error(`Parameter 'options' must contain at least two elements, but this was not the case for ${this.asString()}.`);const n=[];t.forEach(e=>{const t=this.validate(e.value);if(a(t))throw new Error(`Option value ${B(e.value)} (with label '${e.label}') in ${this.asString()} is invalid. Reason: ${t}`);if(n.indexOf(e.value)>-1)throw new Error(`Multiple options with value ${B(e.value)} in ${this.asString()}.`);n.push(e.value)}),this.options=t}toValid(e){return this.default}}const Ze=N+"option-",et=.1,tt=100,nt=function(e){return t=>{const n=document.createElement("form");return it(e,t).forEach(e=>{Xe(e,n)}),n.addEventListener("submit",e=>{e.preventDefault()}),n}}({Boolean:function(e){return _e("label",null,_e("input",{type:"checkbox",checked:ne.get(e),onChange:t=>{ne.set(e,t.target.checked)}}),e.label)},String:function(e){return _e("label",null,e.label,e.multiline?_e("textarea",{value:ne.get(e),onChange:rt(e)}):_e("input",{type:"text",value:ne.get(e),onChange:rt(e)}))},Integer:function(e){return _e("label",null,e.label,_e("input",{type:"number",value:ne.get(e).toString(),onChange:rt(e)}))},Double:function(e){return _e("label",null,e.label,_e("input",{type:"number",value:ne.get(e).toString(),step:et,onChange:rt(e)}))},IntegerRange:function(e){return _e("label",null,e.label,_e("input",{type:"number",value:ne.get(e).toString(),min:e.min,max:e.max,onChange:rt(e)}))},DoubleRange:function(e){return _e("label",null,e.label,_e("input",{type:"number",value:ne.get(e).toString(),min:e.min,max:e.max,step:function(e,t){return Math.min(et,Math.pow(10,Math.floor(Math.log10(t-e)))/tt)}(e.min,e.max).toString(),onChange:rt(e)}))},Multichoice:function(e){const t=ne.get(e),n=e.options;return n.length<=4?_e("fieldset",null,_e("legend",null,e.label),n.map(n=>(function({p:e,label:t,value:n,checked:r}){return _e("label",null,_e("input",{type:"radio",name:ot(e.key),checked:r,onChange:t=>{t.target.checked&&ne.set(e,n)}}),t)})({p:e,label:n.label,value:n.value,checked:n.value===t}))):_e("select",{onChange:t=>{const r=t.target.selectedIndex;r>=0&&r<n.length&&ne.set(e,n[r].value)}},n.map(e=>_e("option",{selected:e.value===t},e.label)))}});function rt(e){return t=>{const n=e.fromString(t.target.value);a(n)?L(n):ne.set(e,n.value)}}function ot(e){return Ze+e}function it(e,t){return Object.keys(t).map(n=>(function(e,t){return t instanceof q?_e("div",Object.assign({id:ot(t.key)},{class:t.extras.class||null}),function(e,t){if(l(X)(t))return e.Boolean(t);if(l(ee)(t))return e.String(t);if(l(z)(t))return e.Integer(t);if(l(Ye)(t))return e.Double(t);if(l(Z)(t))return e.IntegerRange(t);if(l(ze)(t))return e.DoubleRange(t);if(l(Qe)(t))return e.Multichoice(t);throw`Unsupported preference: ${t.getType()} (with key '${t.key}')`}(e,t),_e("aside",{class:R},t.description)):_e("fieldset",null,_e("legend",null,t.label),it(e,t._))})(e,t[n]))}function at(){T("DOMContentLoaded! Performing post-load actions ..."),function(e){setTimeout(me.stop,e)}(S),T(`Hello, ${ne.get(te.username)}!`),T(`This page contains ${document.querySelectorAll("div").length} div(s).`);const e=ne.htmlMenu(nt);document.body.appendChild(e)}d(p(C))?L(`It appears as though ${_} has already run (because a <style> element with id="${C}" was found). Stopping.`):(T(`${_} ${w}`),T("Performing pre-load actions ..."),document.addEventListener("DOMContentLoaded",at),g(oe,C),T("CSS inserted."),me.start(),T("Operations (DOM manipulation etc) started."))}]);