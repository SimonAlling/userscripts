// ==UserScript==
// @name         Better Azure DevOps
// @version      0.1.0
// @match        *://dev.azure.com/*
// @run-at       document-start
// @downloadURL  https://simonalling.github.io/userscripts/better-azure-devops.user.js
// @updateURL    https://simonalling.github.io/userscripts/better-azure-devops.meta.js
// ==/UserScript==
!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=12)}([,,,,,,,,,function(e,t,n){var r=n(10);e.exports="string"==typeof r?r:r.toString()},function(e,t,n){(e.exports=n(11)(!1)).push([e.i,"/*\n******** README ********\n\nThis is the main stylesheet for the userscript.\n\nLogic such as conditions for certain CSS snippets should reside in `stylesheet-modules.ts`.\n*/\n",""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=function(e,t){var n=e[1]||"",r=e[3];if(!r)return n;if(t&&"function"==typeof btoa){var o=function(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}(r),i=r.sources.map(function(e){return"/*# sourceURL="+r.sourceRoot+e+" */"});return[n].concat(i).concat([o]).join("\n")}return[n].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,n){"string"==typeof e&&(e=[[null,e,""]]);for(var r={},o=0;o<this.length;o++){var i=this[o][0];"number"==typeof i&&(r[i]=!0)}for(o=0;o<e.length;o++){var s=e[o];"number"==typeof s[0]&&r[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),t.push(s))}},t}},function(e,t,n){"use strict";n.r(t);const r=[o,i,s,function(e){return"symbol"==typeof e},c,function(e){return void 0===e}];function o(e){return"boolean"==typeof e}function i(e){return"number"==typeof e}function s(e){return"string"==typeof e}function c(e){return null===e}function a(e){return r.some(t=>t(e))}function u(e,t,n){return function(e,t){return Object.defineProperty(t,"name",{value:e,writable:!1})}(`${e.name}(${t.name})`,n)}function l(e){if(a(e))throw new TypeError(`${e.name} cannot be used as a type in the is() function.`);return u(l,e,t=>t instanceof e)}function f(e){for(const t of r)if(t(e))return e=>t(e);if(l(Array)(e))return t=>!(e.length>0)||t.every(f(e[0]));if(e.constructor instanceof Function)return l(e.constructor);throw new TypeError(f.name+" cannot use this object as reference because it has no constructor: "+JSON.stringify(e))}function d(e){return document.getElementById(e)}const p=l(HTMLElement);const h="\n\n";function y(e){return e.map(e=>e.css).join(h)}function g(e,t){!function(e,t){const n=document.createElement("style");if(n.textContent=e,s(t)){if(p(d(t)))throw new Error(`Cannot insert CSS with ID ${JSON.stringify(t)} because there is already an element with that ID.`);n.id=t}document.head.appendChild(n)}(y(e.filter(e=>e.condition)),t)}var v="Azure DevOps";function b(e){return t=>e+t}const m="better-azure-devops",O="Better Azure DevOps",E="0.1.0",w=m+"-",S=500,R=b(m+"-"),N=(b(w),R("main-style-element"));var $=[{condition:!0,css:n(9)}];const k=function(e="[Logger]"){return{log(t){console.log(e,t)},logInfo(t){console.info(e,t)},logWarning(t){console.warn(e,t)},logError(t){console.error(e,t)}}}(`[${O}]`),L=k.log,T=(k.logInfo,k.logWarning),_=k.logError;const P=v,C={absoluteFill:"absolute-fill",boltPortal:"bolt-portal",checked:"checked"},x={diagnosticsCheckbox:".diagnostic-checkbox",runPipelineButton:"#__bolt-run-pipeline-command"},j={pipelineOverviewPath:/^\/\w+\/\w+\/_build$/,pipelineOverviewSearchPart:"_a=summary"},A="    ";function I(e){return t=>e===t}function D(e,t){return n=>e(t(n))}const M=!0,J=!1;class F{constructor(e){this.condition=e.condition,this.description=e.description,this.waitForDOMContentLoaded=function(e,t){return void 0===t?e:t}(!1,e.waitForDOMContentLoaded)}}class U extends F{constructor(e){super(e),this.action=e.action}}class B extends F{constructor(e){super(e),this.selectors=e.selectors,this.action=e.action}}var V;!function(e){e[e.OK=0]="OK",e[e.ABSENT=1]="ABSENT",e[e.TYPE_ERROR=2]="TYPE_ERROR",e[e.JSON_ERROR=3]="JSON_ERROR",e[e.LOCALSTORAGE_ERROR=4]="LOCALSTORAGE_ERROR"}(V||(V={}));const z={Infinity:1/0,"-Infinity":-1/0,NaN:NaN};function G(e,t){try{const n=function(e,t){const n=localStorage.getItem(e);if(c(n))return null;const r=z[n];if(f(t)(r))return r;const o=JSON.parse(n);if(f(t)(o))return o;throw new TypeError("Saved value had wrong type.")}(e,t);return c(n)?{status:1,value:t}:{status:0,value:n}}catch(e){return{status:l(SyntaxError)(e)?3:l(TypeError)(e)?2:4,value:t}}}function K(e,t){try{return function(e,t){const n=function(e){for(const t in z){const n=z[t];if(e===n||Number.isNaN(e)&&Number.isNaN(n))return t}return JSON.stringify(e)}(t);localStorage.setItem(e,n)}(e,t),{status:0,value:t}}catch(e){return{status:l(SyntaxError)(e)||l(TypeError)(e)?3:4,value:t}}}const Y={Infinity:1/0,"-Infinity":-1/0,NaN:NaN};function q(e,t){return void 0===t?e:t}function X(e,t){for(const e in Y){const n=Y[e];if(t===n||Number.isNaN(t)&&Number.isNaN(n))return e}return t}function H(e){return JSON.stringify(e,X)}class W{constructor(e){if(""===e.key)throw new TypeError(`A preference key cannot be the empty string, but this was the case for this ${this.getType()} data:\n${H(e)}`);this.key=e.key,this.default=e.default,this.label=e.label,this.description=q("",e.description),this.constraints=q([],e.constraints),this.dependencies=q([],e.dependencies),this.extras=q({},e.extras);const t=this.validate(e.default);s(t)&&this.invalidValue(e.default,t)}validate(e){const t=this.constraints;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(!r.requirement(e))return r.message(e)}return{value:e}}toValid(e){return s(this.validate(e))?this.default:e}getType(){return this.constructor.name}asString(){return`${this.constructor.name} '${this.key}'`}invalidValue(e,t){throw new Error(`${H(e)} is not a valid value for ${this.asString()}. Reason: ${t}`)}}var Q;function Z(e){return`Unknown preference. Please use only preferences from the object used to initialize the ${ee.name}. This one is not among them:\n\n${H(e)}.`}!function(e){e[e.OK=0]="OK",e[e.INVALID_VALUE=1]="INVALID_VALUE",e[e.TYPE_ERROR=2]="TYPE_ERROR",e[e.JSON_ERROR=3]="JSON_ERROR",e[e.LOCALSTORAGE_ERROR=4]="LOCALSTORAGE_ERROR"}(Q||(Q={}));class ee{constructor(e,t){this.LS_PREFIX=t,this.cache=new Map;const n=[],r=te(e);r.forEach(e=>{const t=e.key;if(n.indexOf(t)>-1)throw new Error(`Duplicate preference key ${H(t)}.`);this.cache.set(e,e.default),n.push(t)}),r.forEach(e=>{e.dependencies.forEach(t=>{if(void 0===this.cache.get(t.preference))throw new Error(`Dependency error in preference ${H(e.key)}: ${Z(t.preference)}`)})})}get(e){const t=this.cache.get(e);if(!f(e.default)(t))throw new Error(Z(e));const n=G(this.LS_PREFIX+e.key,e.default);if(0===n.status){return s(e.validate(n.value))?{status:1,value:e.toValid(n.value),saved:n.value}:{status:0,value:n.value}}return{status:ne(n.status),value:t}}set(e,t){if(!f(e.default)(this.cache.get(e)))throw new Error(Z(e));if(s(e.validate(t)))return{status:1,value:t};this.cache.set(e,t);const n=K(this.LS_PREFIX+e.key,t);return{status:ne(n.status),value:n.value}}}function te(e){return Object.keys(e).map(t=>e[t]).reduce((e,t)=>e.concat(l(W)(t)?t:te(t._)),[])}function ne(e){switch(e){case 0:case 1:return 0;case 2:return 2;case 3:return 3;case 4:return 4}return function(e){throw new Error("assertUnreachable: "+e)}(e)}var re={autoEnableSystemDiagnostics:new class extends W{}({key:"autoEnableSystemDiagnostics",label:"Enable system diagnostics by default",default:!0})};const oe=function(e,t,n){const r=new ee(e,t+"-preference-"),o={get:i,set:s,reset:c,resetAll:function(){te(e).forEach(c)},enabled:function(e){return e.dependencies.every(e=>e.condition(i(e.preference)))},htmlMenu:function(t){return t(e)}};function i(e){return n({action:"get",preference:e,response:r.get(e)},o).value}function s(e,t){n({action:"set",preference:e,response:r.set(e,t)},o)}function c(e){s(e,e.default)}return o}(re,m,function(e,t){const n=e.response;switch(n.status){case 0:return n;case 1:return"get"===e.action&&(T(`The value found in localStorage for preference '${e.preference.key}' (${JSON.stringify(n.saved)}) was invalid. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),"set"===e.action&&T(`Could not set value ${JSON.stringify(n.value)} for preference '${e.preference.key}' because it was invalid.`),n;case 2:return"get"===e.action&&(T(`The value found in localStorage for preference '${e.preference.key}' was not a ${typeof e.preference.default}. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),n;case 3:return"get"===e.action&&(T(`The value found in localStorage for preference '${e.preference.key}' could not be parsed. Replacing it with ${JSON.stringify(n.value)}.`),t.set(e.preference,n.value)),n;case 4:switch(e.action){case"get":return _(`Could not read preference '${e.preference.key}' because localStorage could not be accessed. Using value ${JSON.stringify(e.preference.default)}.`),n;case"set":return _(`Could not save value ${JSON.stringify(e.response.value)} for preference '${e.preference.key}' because localStorage could not be accessed.`),n}return ie(e.action)}return ie(n.status)});function ie(e){throw new Error("assertUnreachable: "+e)}function se(e,t){e:for(const n of e)for(const e of Array.from(n.addedNodes))if(l(HTMLElement)(e)&&ce(e)){const n=e.querySelector(x.diagnosticsCheckbox);null===n?_("System diagnostics checkbox not found."):(L("Ticking system diagnostics checkbox."),ae(n)),t.disconnect();break e}}function ce(e){return[C.absoluteFill,C.boltPortal].every(t=>e.classList.contains(t))}function ae(e){e.classList.contains(C.checked)||e.click()}const ue=function(e,t,n,r){let i=!0,s=!1;function c(e){l(B)(e)&&n(e)}function a(e){const t=(()=>{if(l(U)(e))return e.action();if(l(B)(e)){const t=e.selectors,n=Object.keys(t).map(e=>({key:e,element:document.querySelector(t[e])}));if(n.map(e=>e.element).some(I(null)))return J;const r=n.reduce((e,t)=>Object.defineProperty(e,t.key,{value:t.element}),{});return e.action(r)}throw new TypeError("Unknown operation type.")})();return o(t)?t:M}return document.addEventListener("DOMContentLoaded",()=>{s=!0}),{start:function(){!function e(n){if(i){const r=n.filter(e=>e.waitForDOMContentLoaded),o=n.filter(e=>!e.waitForDOMContentLoaded).concat(s?r:[]).filter(D(I(J),a)).concat(s?[]:r);o.length>0&&setTimeout(()=>{e(o)},t)}else n.length>0?n.forEach(c):r()}(e)},stop:function(){i=!1}}}([new B({description:"enable system diagnostics by default",condition:j.pipelineOverviewPath.test(document.location.pathname)&&document.location.search.includes(j.pipelineOverviewSearchPart)&&oe.get(re.autoEnableSystemDiagnostics),selectors:{runPipelineButton:x.runPipelineButton},action:e=>{const t=new MutationObserver(se);e.runPipelineButton.addEventListener("click",()=>{t.observe(document.body,{attributes:!1,childList:!0,subtree:!0})})}})].filter(e=>e.condition),200,D(_,function(e){const t=Object.keys(e.selectors).length>1;return`Could not ${e.description}.\n\n${t?"One or more of these selectors":"This selector"} didn't match anything:\n\n${function(e){return e.map(e=>A+e).join("\n")}(Object.values(e.selectors))}\n\nThis problem might be caused by ${P} changing its content/structure, in which case ${O} needs to be updated. Otherwise it's probably a bug in ${O}.\n\nIf you file a bug report, please include this message.`}),()=>L("Operations done!"));function le(){L("DOMContentLoaded! Performing post-load actions ..."),function(e){setTimeout(ue.stop,e)}(S)}p(d(N))?T(`It appears as though ${O} has already run (because a <style> element with id="${N}" was found). Stopping.`):(L(`${O} ${E}`),L("Performing pre-load actions ..."),document.addEventListener("DOMContentLoaded",le),g($,N),L("CSS inserted."),ue.start(),L("Operations (DOM manipulation etc) started."))}]);