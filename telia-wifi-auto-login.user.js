// ==UserScript==
// @name         Telia Wi-Fi Auto-Login
// @version      1.0.4
// @match        *://*.teliawifi.telia.com/*
// @run-at       document-start
// @downloadURL  https://simonalling.github.io/userscripts/telia-wifi-auto-login.user.js
// @updateURL    https://simonalling.github.io/userscripts/telia-wifi-auto-login.meta.js
// ==/UserScript==
!function(t){var e={};function n(o){if(e[o])return e[o].exports;var r=e[o]={i:o,l:!1,exports:{}};return t[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(o,r,function(e){return t[e]}.bind(null,r));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([,function(t,e,n){"use strict";n.r(e);var o="Telia Wi-Fi";const r="Telia Wi-Fi Auto-Login",i="Simon Alling",c=1e4;const u=function(t="[Logger]"){return{log(e){console.log(t,e)},logInfo(e){console.info(t,e)},logWarning(e){console.warn(t,e)},logError(e){console.error(t,e)}}}(`[${r}]`),s=u.log,l=(u.logInfo,u.logWarning,u.logError),a=o,f={entry:/^\/TW-Reg\//},d={button_register:'[text="vm.ui.emailRegistrationText.value"] button',checkbox_acceptTerms:'[ng-model="c.agreed"]',button_acceptTerms:"button.terms-agree-button",textfield_email:'input[type="email"]',button_login:'[type="submit"]'},m="    ";function p(t){return e=>t===e}function g(t,e){return n=>t(e(n))}const b=[h,function(t){return"number"==typeof t},function(t){return"string"==typeof t},function(t){return"symbol"==typeof t},function(t){return null===t},function(t){return void 0===t}];function h(t){return"boolean"==typeof t}function y(t){return b.some(e=>e(t))}function O(t,e,n){return function(t,e){return Object.defineProperty(e,"name",{value:t,writable:!1})}(`${t.name}(${e.name})`,n)}function T(t){if(y(t))throw new TypeError(`${t.name} cannot be used as a type in the is() function.`);return O(T,t,e=>e instanceof t)}const k=!0,v=!1;class L{constructor(t){this.condition=t.condition,this.description=t.description,this.waitForDOMContentLoaded=function(t,e){return void 0===e?t:e}(!1,t.waitForDOMContentLoaded)}}class w extends L{constructor(t){super(t),this.action=t.action}}class x extends L{constructor(t){super(t),this.selectors=t.selectors,this.action=t.action}}const M=f.entry.test(document.location.pathname);function _(t){return l(function(t){return`Could not find ${t}.`}(t)),v}const E=function(t,e,n,o){let r=!0,i=!1;function c(t){T(x)(t)&&n(t)}function u(t){const e=(()=>{if(T(w)(t))return t.action();if(T(x)(t)){const e=t.selectors,n=Object.keys(e).map(t=>({key:t,element:document.querySelector(e[t])}));if(n.map(t=>t.element).some(p(null)))return v;const o=n.reduce((t,e)=>Object.defineProperty(t,e.key,{value:e.element}),{});return t.action(o)}throw new TypeError("Unknown operation type.")})();return h(e)?e:k}return document.addEventListener("DOMContentLoaded",()=>{i=!0}),{start:function(){!function t(n){if(r){const o=n.filter(t=>t.waitForDOMContentLoaded),r=n.filter(t=>!t.waitForDOMContentLoaded).concat(i?o:[]).filter(g(p(v),u)).concat(i?[]:o);r.length>0&&setTimeout(()=>{t(r)},e)}else n.length>0?n.forEach(c):o()}(t)},stop:function(){r=!1}}}([new w({description:"inform the user that nothing will be done",condition:!1===M,action:()=>{s(`This doesn't look like the login page (because the current pathname, ${document.location.pathname}, is not matched by ${f.entry}). Doing nothing.`)}}),new x({description:"login automatically",condition:M,selectors:{registerButton:d.button_register},action:t=>{t.registerButton.click(),s("Looking for terms checkbox ...");const e=document.querySelector(d.checkbox_acceptTerms);if(!T(HTMLInputElement)(e))return _("accept checkbox");e.checked||e.click(),s("Looking for terms button ...");const n=document.querySelector(d.button_acceptTerms);if(!T(HTMLButtonElement)(n))return _("accept button");n.click(),s("Looking for email textfield ...");const o=document.querySelector(d.textfield_email);if(!T(HTMLInputElement)(o))return _("email textfield");const r="user@example.com";s(`Entering ${r} as email address ...`),o.value=r,o.dispatchEvent(new Event("change")),s("Looking for login button ...");const i=o.form;if(!T(HTMLFormElement)(i))return _("email form");const c=i.querySelector(d.button_login);if(!T(HTMLElement)(c))return _("login button");c.click(),s("Clicked login button. You should hopefully be logged in now.")}})].filter(t=>t.condition),200,g(l,function(t){const e=Object.keys(t.selectors).length>1;return`Could not ${t.description}.\n\n${e?"One or more of these selectors":"This selector"} didn't match anything:\n\n${function(t){return t.map(t=>m+t).join("\n")}(Object.values(t.selectors))}\n\nThis problem might be caused by ${a} changing its content/structure, in which case ${r} needs to be updated. Otherwise it's probably a bug in ${r}.\n\nIf you file a bug report, please include this message.`}),()=>s("Operations done!"));function $(){s("DOMContentLoaded! Performing post-load actions ..."),function(t){setTimeout(E.stop,t)}(c)}s(`Userscript created by ${i}.`),s("Performing pre-load actions ..."),document.addEventListener("DOMContentLoaded",$),E.start(),s("Operations (DOM manipulation etc) started.")}]);